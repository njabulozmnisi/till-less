# Story 4.1: BetterAuth Integration & Session Management

- **Status:** Draft
- **Epic:** 4 â€“ Account & Auth Enablement
- **Related PRD Sections:** `docs/prd/07-7-detailed-requirements.md`
- **Related Architecture Sections:** `docs/architecture/04-4-component-breakdown.md`, `docs/architecture/06-6-technology-stack.md`

## Story Statement
Integrate BetterAuth across Next.js and NestJS so users can register, authenticate, and maintain sessions securely in the MVP.

## Acceptance Criteria
- [ ] BetterAuth service deployed (Docker or Vercel) with Supabase Postgres backing store; environment variables managed securely.
- [ ] Next.js app implements signup/login flows using BetterAuth SDK with email/password and social login placeholder off.
- [ ] NestJS API validates BetterAuth JWTs via guard; roles/claims enforced for protected endpoints.
- [ ] Refresh token rotation and session revocation supported; logout clears client state.
- [ ] Automated tests cover auth flows and protected route access.

## Tasks & Subtasks
1. **BetterAuth Deployment**
   - Configure service with Postgres connection, email templates, password policy.
2. **Frontend Auth Flows**
   - Build login/register pages, password reset, session persistence.
3. **Backend Guards & Decorators**
   - Implement NestJS guard verifying JWT, extract user context, enforce scopes.
4. **DevOps & Secrets**
   - Store BetterAuth keys/secrets in GitHub Actions + Supabase secrets; document rotation.
5. **Testing**
   - Cypress or Playwright tests for auth flows; Jest tests for guards.

## Dependencies
- Database available, email provider for verification (Resend free tier).

## QA Checklist
- [ ] Video of signup/login/logout flows.
- [ ] Evidence of protected endpoint returning 401 when unauthenticated.

## Implementation Log
| Date | Author | Notes |
| --- | --- | --- |

## QA Results
| Date | Reviewer | Outcome | Notes |
| --- | --- | --- | --- |

## File Tracker
- _To be completed during implementation._
