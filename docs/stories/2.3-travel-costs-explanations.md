# Story 2.3: Travel Costs & Explanation Engine

- **Status:** Draft
- **Epic:** 2 – Optimisation Engine & API
- **Related PRD Sections:** `docs/prd/07-7-detailed-requirements.md`, `docs/prd/08-8-user-journeys.md`
- **Related Architecture Sections:** `docs/architecture/05-5-key-data-flows.md`

## Story Statement
Incorporate travel/time cost modelling and human-readable explanations so users understand trade-offs between price and effort when choosing the recommended store.

## Acceptance Criteria
- [ ] Travel cost heuristics implemented (distance × value-of-time) using configurable rate tables or optional OSRM integration.
- [ ] API response includes `assumptions` section with travel cost inputs, total effort score, and sensitivity notes.
- [ ] Explanations generated for top recommendation (why store wins) and runner-up comparisons.
- [ ] User preferences (max stores, value-of-time) respected in optimisation constraints.
- [ ] Tests validate calculation across cases (local store vs distant store, high vs low value-of-time).

## Tasks & Subtasks
1. **Travel Data Module**
   - Implement service to fetch or compute distance (static table + optional OSRM call).
   - Cache results to avoid repeated lookups.
2. **Cost Integration**
   - Incorporate travel cost into total saving calculation; adjust recommendation scoring.
3. **Explanation Formatter**
   - Build utility generating narrative summary (price vs travel trade-off, promos applied, missing items).
   - Update response schema to include `explanations` array.
4. **Preference Enforcement**
   - Ensure max store constraint (default 1) enforced; fallback message when violation occurs.
5. **Testing**
   - Unit tests for travel cost calculations and explanation output.
   - Integration tests verifying final recommendation matches expected scenario.

## Implementation Notes
- Provide feature flag to swap between static distance table and OSRM integration for future upgrades.
- Ensure explanation text is concise (<200 chars) and localizable.

## Dependencies
- Stories 2.1 and 2.2 completed.
- Travel rate table/config defined (coordinate with PM for values).

## QA Checklist
- [ ] Test evidence for multiple travel scenarios.
- [ ] Sample API output with explanations attached.

## Implementation Log
| Date | Author | Notes |
| --- | --- | --- |

## QA Results
| Date | Reviewer | Outcome | Notes |
| --- | --- | --- | --- |

## File Tracker
- _To be completed during implementation._
