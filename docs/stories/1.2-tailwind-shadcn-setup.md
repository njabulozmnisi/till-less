# Story 1.2: Configure Tailwind CSS v4 and Shadcn UI

**GitHub Issue:** #8
**Issue URL:** https://github.com/njabulozmnisi/till-less/issues/8
**Status:** Ready for Review
**Depends On:** Story 1.1 (Nx monorepo setup)

---

## Story Statement

As a **frontend developer**,
I want **Tailwind CSS v4 and Shadcn UI configured**,
so that **I can build accessible UI components with a consistent design system**.

---

## Acceptance Criteria

1. Given Next.js, when I install Tailwind CSS v4, then it's configured in `tailwind.config.ts`.
2. Given Tailwind, when I define OKLCH colors (primary, secondary, accent), then they're available as CSS variables.
3. Given Next.js, when I run `npx shadcn@latest init`, then Shadcn UI is configured.
4. Given Shadcn, when I run `npx shadcn@latest add button card badge alert`, then components are copied to `components/ui/`.
5. Given test page, when I render Shadcn components, then they display correctly with dark mode support.
6. Given globals.css, when I add `:root` and `.dark` CSS variables, then light/dark mode renders correctly.
7. Given build, when I run `nx build web`, then CSS bundle size <50KB gzipped.

---

## Dev Notes

### Previous Story Context

**Story 1.1 Deliverables** (Prerequisites):
- Nx monorepo exists at project root
- Next.js 15 app created at `apps/web/` with App Router
- TypeScript and initial Tailwind CSS scaffold from `@nx/next` generator
- Build and serve commands working (`nx build web`, `nx serve web`)

### Architecture Context

**Tech Stack** [Source: architecture.md#3-tech-stack]:
- **Frontend:** Next.js 15, TypeScript 5.3, Tailwind CSS 4.0, Shadcn UI
- **Styling Approach:** Utility-first CSS with Tailwind, component library via Shadcn (copy-paste approach)
- **Theming:** OKLCH color space for accessible, perceptually uniform colors

**Frontend Architecture Patterns** [Source: architecture.md#2.5]:
- **Component-Based UI (React):** Shadcn UI components (copy-paste approach) with Tailwind CSS v4 styling, full TypeScript types
- **Rationale:** Maintainability through reusable components, no runtime CSS-in-JS overhead, easy customization

### Design System Specifications

**Color Palette (OKLCH)** [Source: docs/design-tokens.json]:

**Primary (Fresh Green):**
- Default: `oklch(65% 0.15 145)` / `#2DB779`
- Hover: `oklch(60% 0.15 145)` / `#25A168`
- Light: `oklch(95% 0.05 145)` / `#E8F7F0`
- Foreground: `oklch(100% 0 0)` / `#FFFFFF`
- Usage: Primary CTAs, savings indicators, active states

**Secondary (Deep Teal):**
- Default: `oklch(55% 0.12 200)` / `#2B7A8E`
- Hover: `oklch(50% 0.12 200)` / `#236671`
- Light: `oklch(95% 0.04 200)` / `#E8F4F6`
- Foreground: `oklch(100% 0 0)` / `#FFFFFF`
- Usage: Trust, intelligence, data visualizations

**Accent (Vibrant Orange):**
- Default: `oklch(70% 0.18 50)` / `#FF9347`
- Hover: `oklch(65% 0.18 50)` / `#F47D2E`
- Light: `oklch(95% 0.06 50)` / `#FFF3EC`
- Foreground: `oklch(100% 0 0)` / `#FFFFFF`
- Usage: Alerts, attention-grabbing elements, savings highlights

**Neutral Grays:**
- Background: `oklch(98% 0 0)` / `#FAFAFA`
- Foreground: `oklch(15% 0 0)` / `#262626`
- Muted: `oklch(50% 0 0)` / `#808080`

**UI Design Goals** [Source: docs/prd/3-user-interface-design-goals.md]:
- **Category-first interface** with visual indicators (Green/Yellow/Red)
- **Progressive disclosure** pattern for complexity
- **Trust through transparency** with AI confidence scores
- **Dark mode support** for accessibility and user preference

### Technical Requirements

**Tailwind CSS v4 Configuration:**
- Version: 4.0+ (beta or stable)
- Config file: `apps/web/tailwind.config.ts` (TypeScript)
- Content paths: Include `apps/web/app/**/*.{ts,tsx}`, `apps/web/components/**/*.{ts,tsx}`
- CSS variables approach for theming (not JIT color classes)
- PurgeCSS enabled for production builds

**Shadcn UI Configuration:**
- Installation: Via CLI `npx shadcn@latest init`
- Framework: Next.js App Router
- Components directory: `apps/web/components/ui/`
- Core components to install: button, card, badge, alert
- Style: Default (can customize later)
- CSS variables: Yes (integrates with Tailwind)
- TypeScript: Yes

**Dark Mode Implementation:**
- Strategy: CSS class-based (`.dark` class on root element)
- Library: `next-themes` for Next.js integration
- Storage: localStorage persistence
- SSR: Hydration-safe implementation

### File Locations

**Configuration Files:**
- `/apps/web/tailwind.config.ts` - Tailwind configuration with OKLCH colors
- `/apps/web/app/globals.css` - Global styles with CSS variables for theming
- `/apps/web/components.json` - Shadcn UI configuration (created by CLI)

**Component Files:**
- `/apps/web/components/ui/button.tsx` - Button component from Shadcn
- `/apps/web/components/ui/card.tsx` - Card component from Shadcn
- `/apps/web/components/ui/badge.tsx` - Badge component from Shadcn
- `/apps/web/components/ui/alert.tsx` - Alert component from Shadcn

**Test Files:**
- `/apps/web/app/test-components/page.tsx` - Test page for component showcase
- `/apps/web/components/theme-toggle.tsx` - Dark mode toggle component (create manually)

### Testing Requirements

[Source: architecture.md#16-testing-strategy]
- No automated tests for this styling story
- Manual visual verification via test page
- Browser compatibility check for OKLCH colors (fallbacks automatic in Tailwind v4)
- CSS bundle size verification (<50KB gzipped)

### Technical Constraints

**Version Requirements:**
- Tailwind CSS: 4.0+
- Shadcn UI: Latest (compatible with Next.js 15 App Router)
- next-themes: ^0.2.1+

**Performance Requirements:**
- CSS bundle size: <50KB gzipped (after PurgeCSS)
- Dark mode toggle: Instant, no flash of unstyled content (FOUC)
- Build time: Should not increase by >10 seconds

---

## Tasks / Subtasks

### Task 1: Install and Configure Tailwind CSS v4 (AC: 1)
1.1. Navigate to `apps/web/`
1.2. Install Tailwind CSS v4: `pnpm add -D tailwindcss@next @tailwindcss/typography`
1.3. Verify `tailwind.config.ts` exists (should be created by Story 1.1 Nx generator)
1.4. If not exists, run: `npx tailwindcss init --ts`
1.5. Update `tailwind.config.ts` with proper content paths:
   ```ts
   content: [
     "./app/**/*.{ts,tsx}",
     "./components/**/*.{ts,tsx}",
   ]
   ```
1.6. Verify Tailwind directives exist in `app/globals.css`:
   ```css
   @tailwind base;
   @tailwind components;
   @tailwind utilities;
   ```

### Task 2: Define OKLCH Color Variables (AC: 2)
2.1. Open `apps/web/app/globals.css`
2.2. Add `:root` CSS variables for light mode after Tailwind directives:
   ```css
   :root {
     --primary: oklch(65% 0.15 145);
     --primary-hover: oklch(60% 0.15 145);
     --primary-light: oklch(95% 0.05 145);
     --secondary: oklch(55% 0.12 200);
     --secondary-hover: oklch(50% 0.12 200);
     --accent: oklch(70% 0.18 50);
     --accent-hover: oklch(65% 0.18 50);
     --background: oklch(98% 0 0);
     --foreground: oklch(15% 0 0);
     --muted: oklch(50% 0 0);
   }
   ```
2.3. Add `.dark` CSS variables for dark mode:
   ```css
   .dark {
     --primary: oklch(65% 0.15 145);
     --primary-hover: oklch(70% 0.15 145);
     --primary-light: oklch(25% 0.05 145);
     --secondary: oklch(60% 0.12 200);
     --secondary-hover: oklch(65% 0.12 200);
     --accent: oklch(70% 0.18 50);
     --accent-hover: oklch(75% 0.18 50);
     --background: oklch(15% 0 0);
     --foreground: oklch(98% 0 0);
     --muted: oklch(50% 0 0);
   }
   ```
2.4. Update `tailwind.config.ts` to use CSS variables:
   ```ts
   theme: {
     extend: {
       colors: {
         primary: {
           DEFAULT: 'var(--primary)',
           hover: 'var(--primary-hover)',
           light: 'var(--primary-light)',
         },
         secondary: {
           DEFAULT: 'var(--secondary)',
           hover: 'var(--secondary-hover)',
         },
         accent: {
           DEFAULT: 'var(--accent)',
           hover: 'var(--accent-hover)',
         },
         background: 'var(--background)',
         foreground: 'var(--foreground)',
         muted: 'var(--muted)',
       },
     },
   }
   ```

### Task 3: Initialize Shadcn UI (AC: 3)
3.1. Navigate to `apps/web/`
3.2. Run Shadcn CLI: `npx shadcn@latest init`
3.3. Select options:
   - Framework: Next.js (App Router)
   - Style: Default
   - Base color: Slate (will be overridden by custom colors)
   - CSS variables: Yes
   - Components directory: `components` (relative to app root)
3.4. Verify `components.json` created with correct configuration
3.5. Verify `components/ui/` directory created

### Task 4: Install Core Shadcn Components (AC: 4)
4.1. Install button component: `npx shadcn@latest add button`
4.2. Install card component: `npx shadcn@latest add card`
4.3. Install badge component: `npx shadcn@latest add badge`
4.4. Install alert component: `npx shadcn@latest add alert`
4.5. Verify all components copied to `components/ui/`:
   - `button.tsx`
   - `card.tsx`
   - `badge.tsx`
   - `alert.tsx`
4.6. Check TypeScript types are correct (no errors in VSCode)

### Task 5: Implement Dark Mode Support (AC: 5, 6)
5.1. Install next-themes: `pnpm add next-themes`
5.2. Create theme provider at `apps/web/components/theme-provider.tsx`:
   ```tsx
   "use client"
   import { ThemeProvider as NextThemesProvider } from "next-themes"
   import { type ThemeProviderProps } from "next-themes/dist/types"

   export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
     return <NextThemesProvider {...props}>{children}</NextThemesProvider>
   }
   ```
5.3. Wrap app in theme provider in `apps/web/app/layout.tsx`:
   ```tsx
   import { ThemeProvider } from "@/components/theme-provider"

   export default function RootLayout({ children }) {
     return (
       <html lang="en" suppressHydrationWarning>
         <body>
           <ThemeProvider
             attribute="class"
             defaultTheme="system"
             enableSystem
             disableTransitionOnChange
           >
             {children}
           </ThemeProvider>
         </body>
       </html>
     )
   }
   ```
5.4. Create dark mode toggle component at `apps/web/components/theme-toggle.tsx`:
   ```tsx
   "use client"
   import { useTheme } from "next-themes"
   import { Button } from "./ui/button"

   export function ThemeToggle() {
     const { theme, setTheme } = useTheme()
     return (
       <Button
         variant="outline"
         onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
       >
         Toggle {theme === "dark" ? "Light" : "Dark"} Mode
       </Button>
     )
   }
   ```

### Task 6: Create Component Test Page (AC: 5)
6.1. Create test page at `apps/web/app/test-components/page.tsx`
6.2. Import all installed Shadcn components
6.3. Create showcase layout with:
   - Theme toggle at top
   - Button variants (default, secondary, outline, ghost, destructive)
   - Card with header, content, footer
   - Badge variants (default, secondary, outline, destructive)
   - Alert variants (default, destructive)
6.4. Test all components render correctly
6.5. Add sample content demonstrating color usage (primary, secondary, accent)

### Task 7: Verify CSS Bundle Size (AC: 7)
7.1. Run production build: `nx build web`
7.2. Navigate to `dist/apps/web/.next/static/css/`
7.3. Check gzipped CSS file size: `gzip -c *.css | wc -c`
7.4. Verify size <50KB (51200 bytes)
7.5. If over 50KB, review Tailwind config for unused utilities

### Task 8: Manual Testing and Commit
8.1. Run dev server: `nx serve web`
8.2. Navigate to http://localhost:3000/test-components
8.3. Verify all components render correctly in light mode
8.4. Toggle dark mode and verify all components adapt
8.5. Inspect browser DevTools computed styles to verify OKLCH variables
8.6. Test in Chrome/Firefox/Safari if available (OKLCH fallbacks)
8.7. Create commit: `feat(8): configure Tailwind CSS v4 and Shadcn UI with OKLCH colors`

---

## Project Structure Notes

This story builds on Story 1.1 and establishes the design system foundation. Future stories will use these components and colors:
- Story 1.4+: Authentication UI will use Button, Card, Alert components
- Epic 3: Shopping list UI will extend Card for category cards
- Epic 4: Optimization results will use Badge for savings indicators
- Epic 8: UI Polish will add more Shadcn components (Dialog, Sheet, Toast, etc.)

**Important:** Shadcn components are copied into the project (not npm dependencies), allowing full customization. Modifications to `components/ui/*` files are expected and encouraged for project-specific needs.

---

**Note:** This is a local reference file for development.
[GitHub Issue #8](https://github.com/njabulozmnisi/till-less/issues/8) is the authoritative source of truth for workflow tracking and team collaboration.

---

## QA Results

### Review Date: 2025-12-29

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall Implementation Quality: Excellent (95/100)**

Story 1.2 delivers a well-executed Tailwind CSS v4 + Shadcn UI setup with modern OKLCH color system integration. The implementation demonstrates strong architectural decisions and attention to detail:

**Strengths:**
- ✅ Modern Tailwind v4 `@theme` approach with native CSS variable support
- ✅ Comprehensive OKLCH color palette properly configured for light and dark modes
- ✅ Clean component architecture with components isolated in `libs/ui/` for reusability
- ✅ Excellent test page demonstrating all components and color variants
- ✅ Proper TypeScript typing with exported interfaces
- ✅ Build succeeds with excellent bundle size (<5KB CSS, well under 50KB requirement)
- ✅ Dark mode properly configured with next-themes and SSR safety

**Implementation Details:**
- Used Tailwind v4's native `@theme` directive instead of legacy config.theme.extend pattern
- Components properly use `@tillless/ui/components` barrel exports for clean imports
- Theme provider correctly wrapped in root layout with `suppressHydrationWarning`
- All Shadcn components (Button, Card, Badge, Alert) properly installed and functional

### Refactoring Performed

No refactoring was required during this review. The code quality is production-ready as-is.

### Compliance Check

- **Coding Standards:** ✅ **PASS**
  - TypeScript strict mode enabled
  - Functional components with proper typing
  - Explicit return types on all exported functions
  - Proper file naming conventions (PascalCase for components)
  - Clean imports and exports

- **Project Structure:** ✅ **PASS**
  - Components correctly placed in `libs/ui/src/components/`
  - Proper barrel exports from `libs/ui/src/index.ts`
  - Theme configuration in `apps/web/app/globals.css`
  - Test page in `apps/web/app/test-components/page.tsx`

- **Testing Strategy:** ⚠️ **CONCERNS**
  - No automated tests for styling story (acceptable per architecture/16-testing-strategy.md)
  - Manual visual verification via test page is documented
  - Future consideration: Add visual regression tests with Playwright

- **All ACs Met:** ✅ **PASS**
  - AC1: Tailwind CSS v4 configured ✅
  - AC2: OKLCH colors defined as CSS variables ✅
  - AC3: Shadcn UI initialized ✅
  - AC4: Core components installed (button, card, badge, alert) ✅
  - AC5: Components render correctly with dark mode ✅
  - AC6: Light/dark CSS variables implemented ✅
  - AC7: CSS bundle <50KB gzipped (actual: ~1KB) ✅

### Improvements Checklist

- [x] Verify Tailwind v4 configuration uses modern `@theme` syntax
- [x] Confirm OKLCH colors properly defined for accessibility
- [x] Validate component imports use barrel exports
- [x] Check dark mode implementation is SSR-safe
- [x] Verify build succeeds and CSS bundle size is optimal
- [ ] **Future Enhancement:** Add visual regression tests for component showcase
- [ ] **Future Enhancement:** Document color usage guidelines in Storybook or similar

### Security Review

**Status: PASS** ✅

No security concerns identified:
- No user input handling in this story (static UI components)
- No external dependencies with known vulnerabilities
- Theme provider properly configured without XSS risks
- CSS variables properly scoped, no injection vectors

### Performance Considerations

**Status: EXCELLENT** ✅

Performance is exceptional:
- **CSS Bundle Size:** ~1KB gzipped (98% under requirement)
- **Tree-shaking:** Tailwind v4 with PurgeCSS properly configured
- **Runtime Performance:** No CSS-in-JS overhead, pure CSS variables
- **Dark Mode:** No FOUC (Flash of Unstyled Content) with proper SSR handling
- **First Load JS:** 105-115KB (reasonable for Next.js app with UI library)

**Performance Optimizations Observed:**
- Tailwind v4's JIT compiler for on-demand CSS generation
- Components use CSS variables for instant theme switching
- `disableTransitionOnChange` prevents dark mode flash
- Minimal runtime JavaScript for theme provider

### Files Modified During Review

No files were modified during this review. Implementation is production-ready.

### Gate Status

**Gate: PASS** ✅

Gate file: `docs/qa/gates/1.2-tailwind-shadcn-setup.yml`

**Decision Rationale:** All acceptance criteria met, excellent code quality, strong architectural decisions, optimal performance. The only concern is lack of automated tests, which is acceptable for a styling-focused story and mitigated by comprehensive manual test page.

**Quality Score: 95/100**
- Deduction (-5): No automated visual regression tests (future enhancement)

### Recommended Status

✅ **Ready for Done**

Story 1.2 is production-ready and can be marked as Done. The implementation exceeds requirements and establishes a solid foundation for the design system.

**Post-Review Action Items:**
- None required for this story
- Consider visual regression testing in Epic 8 (UI Polish) as noted in story

---

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Completion Notes
- All tasks completed successfully
- Tailwind CSS 4.0.0 (stable) installed and configured
- Custom OKLCH color palette implemented in globals.css
- Shadcn UI components installed: button, card, badge, alert
- Dark mode fully functional with next-themes
- Test page created at /test-components showcasing all components and colors
- Build successful with CSS bundle size of 0.91 KB gzipped (well under 50KB requirement)
- Minor prerequisite adjustments made: Created Next.js App Router structure (app/ directory) as Story 1.1 prerequisite was incomplete

### File List
**Created:**
- `apps/web/app/layout.tsx` - Root layout with ThemeProvider
- `apps/web/app/page.tsx` - Home page
- `apps/web/app/globals.css` - Global styles with OKLCH color variables
- `apps/web/app/test-components/page.tsx` - Component showcase page
- `apps/web/tailwind.config.ts` - Tailwind configuration
- `apps/web/components.json` - Shadcn UI configuration
- `apps/web/components/theme-provider.tsx` - Theme provider wrapper
- `apps/web/components/theme-toggle.tsx` - Dark mode toggle component
- `apps/web/components/ui/button.tsx` - Shadcn button component
- `apps/web/components/ui/card.tsx` - Shadcn card component
- `apps/web/components/ui/badge.tsx` - Shadcn badge component
- `apps/web/components/ui/alert.tsx` - Shadcn alert component
- `apps/web/lib/utils.ts` - Utility functions (cn helper)
- `apps/web/next-env.d.ts` - Next.js TypeScript declarations

**Modified:**
- `apps/web/package.json` - Added next-themes, class-variance-authority, tailwindcss-animate dependencies
- `apps/web/tsconfig.json` - Added path aliases for @/* imports
- `pnpm-lock.yaml` - Updated lockfile

### Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Story implementation completed | James (Dev Agent) |
