# Story 3.1: Shopping List Input & Import UI

## Status
Draft

## Story
**As a** TillLess shopper,
**I want** a responsive shopping list builder that supports manual entry and CSV import,
**so that** I can capture quantities, units, and substitution preferences before running optimisation.

## Acceptance Criteria
1. Responsive list builder enables add/edit/remove of items with validation on required fields, recognised units, substitution tolerance, and must-have flags. [Source: docs/prd/07-7-detailed-requirements.md#71-functional-requirements]
2. CSV import supports the standard template, surfaces inline validation errors, and maps data into the list state without page reloads. [Source: docs/prd/07-7-detailed-requirements.md#71-functional-requirements]
3. Draft lists persist to backend optimisation API via authenticated BetterAuth session with auto-save every 30 seconds and clear loading/error states. [Source: docs/architecture/04-4-component-breakdown.md#46-frontend-web-application]
4. UI meets accessibility baseline (keyboard navigation, ARIA labels, focus management) and aligns with TillLess design system components. [Source: docs/architecture/04-4-component-breakdown.md#46-frontend-web-application]
5. Jest + React Testing Library coverage exists for core components, including form validation, CSV import, and persistence hooks. [Source: docs/architecture/testing-strategy.md#testing-strategy]

## Tasks / Subtasks
- [ ] Implement list builder components (AC: 1, 4)
  - [ ] Build item row, quantity/unit selectors, substitution toggle, and must-have checkbox using design system primitives under `apps/web/app/(authenticated)/shopping-list/components/`. [Source: docs/architecture/source-tree.md#source-tree--module-layout]
  - [ ] Add form validation (react-hook-form or equivalent) enforcing recognised units and substitution tolerance rules. [Source: docs/prd/07-7-detailed-requirements.md#71-functional-requirements]
- [ ] CSV import workflow (AC: 2)
  - [ ] Integrate Papaparse (or equivalent) in `apps/web/app/(authenticated)/shopping-list/utils/` to parse template CSV, map columns, and collect errors for inline display. [Source: docs/prd/07-7-detailed-requirements.md#71-functional-requirements]
  - [ ] Provide download link to CSV template and summary of rejected rows with correction guidance. [Source: docs/prd/05-5-scope-phase-1-mvp.md#51-in-scope]
- [ ] Persistence & auto-save (AC: 3)
  - [ ] Implement React Query/Zustand store handling list state, auto-save interval, optimistic updates, and rollback on error. [Source: docs/architecture/04-4-component-breakdown.md#46-frontend-web-application]
  - [ ] Call backend `/lists` endpoint with BetterAuth token; surface success toast and failure banner with retry. [Source: docs/prd/05-5-scope-phase-1-mvp.md#51-in-scope]
- [ ] Accessibility & UX polish (AC: 1, 4)
  - [ ] Ensure keyboard navigation, focus outlines, ARIA labels, and error messaging comply with WCAG AA guidance. [Source: docs/architecture/04-4-component-breakdown.md#46-frontend-web-application]
  - [ ] Provide empty state copy explaining manual entry vs CSV import and highlight substitution settings. [Source: docs/prd/08-8-user-journeys.md#8-user-journeys]
- [ ] Testing & documentation (AC: 5)
  - [ ] Add Jest/React Testing Library suites covering component rendering, validation, CSV parsing, and auto-save behaviours; snapshot key states as needed. [Source: docs/architecture/testing-strategy.md#testing-strategy]
  - [ ] Update `apps/web/README.md` with usage instructions, testing commands, and CSV template reference. [Source: docs/architecture/source-tree.md#source-tree--module-layout]

## Dev Notes
**Dependencies & Context**
- Relies on backend optimisation endpoints (Story 2.1) and user authentication (Epic 4 BetterAuth integration). Ensure API hooks accept session context. [Source: docs/stories/2.1-optimisation-service-foundation.md]

**Front-End Architecture**
- Frontend Next.js app under `apps/web` uses design system components, React Query state, and BetterAuth SDK; follow the shared patterns for new modules. [Source: docs/architecture/04-4-component-breakdown.md#46-frontend-web-application]
- Persist lists through API gateway ensuring consistent DTOs with backend contracts (validate against Swagger output from Story 2.1).

**CSV Template**
- Template captures item name, preferred brand, quantity, unit, substitution tolerance, must-have flag. Provide download and sample preview for user clarity. [Source: docs/prd/07-7-detailed-requirements.md#71-functional-requirements]

**Accessibility**
- Maintain keyboard operability and announce validation errors to screen readers; use ARIA `aria-live` regions for auto-save notifications.

**Performance & Resilience**
- Auto-save interval should debounce user edits to avoid excessive API calls; handle offline mode by queueing pending saves and informing user.

### Testing
- Unit/component tests: React Testing Library for form interactions, CSV parsing success/failure, auto-save triggers. [Source: docs/architecture/testing-strategy.md#testing-strategy]
- Integration tests: combine store + API mock to verify persistence flow and error handling.
- Manual QA: screen recording demonstrating entry, CSV import, auto-save, validation, and keyboard navigation; run axe accessibility audit.
- Key scenarios: valid CSV import, invalid CSV row, loss of network during auto-save, toggling substitution preferences, accessibility check for focus order.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-09-28 | v0.1 | Initial draft prepared by Scrum Master | Bob |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
| Date | Reviewer | Outcome | Notes |
| --- | --- | --- | --- |
